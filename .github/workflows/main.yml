name: Build Complete Tailwind CSS

on:
  push:
    branches: [ main, master, localize ]
  workflow_dispatch:

jobs:
  build-css:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
        
    - name: Create assets directory
      run: mkdir -p assets src
      
    - name: Download Tailwind CSS standalone
      run: |
        curl -sLo tailwindcss "https://github.com/tailwindlabs/tailwindcss/releases/latest/download/tailwindcss-linux-x64"
        chmod +x tailwindcss
        
    - name: Create Tailwind input
      run: |
        cat > src/input.css << 'EOF'
        @tailwind base;
        @tailwind components;
        @tailwind utilities;
        EOF
        
    - name: Create Tailwind config
      run: |
        cat > tailwind.config.js << 'EOF'
        module.exports = {
          content: [
            "./index.html",
            "./temp-classes.html"
          ],
          theme: {
            extend: {}
          },
          plugins: []
        }
        EOF
        
    - name: Generate comprehensive HTML for scanning
      run: |
        cat > temp-classes.html << 'EOF'
        <!DOCTYPE html>
        <html>
        <body>
        <!-- Layout Classes -->
        <div class="container mx-auto max-w-sm max-w-md max-w-lg max-w-xl max-w-2xl max-w-4xl max-w-6xl">
          <div class="p-1 p-2 p-3 p-4 p-5 p-6 p-8 px-2 px-3 px-4 px-6 py-2 py-3 py-4 py-6">
            <div class="m-1 m-2 m-3 m-4 m-6 mx-2 mx-4 mx-auto my-2 my-4 my-6">
              <div class="mt-2 mt-4 mt-6 mt-8 mb-2 mb-4 mb-6 ml-2 ml-4 mr-2 mr-4">
        
        <!-- Flexbox -->
        <div class="flex flex-col flex-row items-start items-center items-end justify-start justify-center justify-between justify-around">
          <div class="flex-1 flex-auto flex-none flex-grow flex-shrink">
        
        <!-- Grid -->
        <div class="grid grid-cols-1 grid-cols-2 grid-cols-3 grid-cols-4 grid-cols-6 grid-cols-12">
          <div class="gap-1 gap-2 gap-3 gap-4 gap-6 gap-8">
        
        <!-- Sizing -->
        <div class="w-full w-auto w-1/2 w-1/3 w-1/4 w-2/3 w-3/4 h-full h-auto h-screen min-h-screen">
          <div class="min-w-0 min-w-full max-w-none max-w-xs">
        
        <!-- Typography -->
        <h1 class="text-xs text-sm text-base text-lg text-xl text-2xl text-3xl text-4xl">
        <p class="font-thin font-light font-normal font-medium font-semibold font-bold font-extrabold">
        <span class="text-left text-center text-right text-justify">
        <div class="leading-3 leading-4 leading-5 leading-6 leading-7 leading-8">
        
        <!-- Colors -->
        <div class="text-white text-black text-gray-50 text-gray-100 text-gray-200 text-gray-300 text-gray-400 text-gray-500 text-gray-600 text-gray-700 text-gray-800 text-gray-900">
        <div class="bg-white bg-black bg-gray-50 bg-gray-100 bg-gray-200 bg-gray-300 bg-gray-400 bg-gray-500 bg-gray-600 bg-gray-700 bg-gray-800 bg-gray-900">
        <div class="bg-transparent bg-current">
        
        <!-- Borders -->
        <div class="border border-0 border-2 border-4 border-8">
        <div class="border-solid border-dashed border-dotted border-double border-none">
        <div class="border-gray-100 border-gray-200 border-gray-300 border-gray-400 border-gray-500">
        <div class="border-t border-r border-b border-l">
        <div class="rounded rounded-sm rounded-md rounded-lg rounded-xl rounded-2xl rounded-3xl rounded-full">
        <div class="rounded-t rounded-r rounded-b rounded-l">
        
        <!-- Display -->
        <div class="block inline inline-block flex inline-flex table inline-table table-caption table-cell table-column table-column-group table-footer-group table-header-group table-row-group table-row grid inline-grid contents list-item hidden">
        
        <!-- Position -->
        <div class="static relative absolute fixed sticky">
        <div class="top-0 top-1 top-2 top-4 right-0 right-1 right-2 right-4 bottom-0 bottom-1 bottom-2 bottom-4 left-0 left-1 left-2 left-4">
        <div class="inset-0 inset-1 inset-2 inset-4 inset-x-0 inset-y-0">
        
        <!-- Z-Index -->
        <div class="z-0 z-10 z-20 z-30 z-40 z-50 z-auto">
        
        <!-- Overflow -->
        <div class="overflow-auto overflow-hidden overflow-visible overflow-scroll overflow-x-auto overflow-y-auto overflow-x-hidden overflow-y-hidden overflow-x-visible overflow-y-visible overflow-x-scroll overflow-y-scroll">
        
        <!-- Shadows -->
        <div class="shadow shadow-sm shadow-md shadow-lg shadow-xl shadow-2xl shadow-inner shadow-none">
        
        <!-- Opacity -->
        <div class="opacity-0 opacity-5 opacity-10 opacity-20 opacity-25 opacity-30 opacity-40 opacity-50 opacity-60 opacity-70 opacity-75 opacity-80 opacity-90 opacity-95 opacity-100">
        
        <!-- Transitions -->
        <div class="transition transition-none transition-all transition-colors transition-opacity transition-shadow transition-transform">
        <div class="duration-75 duration-100 duration-150 duration-200 duration-300 duration-500 duration-700 duration-1000">
        <div class="ease-linear ease-in ease-out ease-in-out">
        
        <!-- Transforms -->
        <div class="transform transform-gpu transform-none">
        <div class="scale-0 scale-50 scale-75 scale-90 scale-95 scale-100 scale-105 scale-110 scale-125 scale-150">
        <div class="rotate-0 rotate-1 rotate-2 rotate-3 rotate-6 rotate-12 rotate-45 rotate-90 rotate-180">
        <div class="translate-x-0 translate-x-1 translate-x-2 translate-x-4 translate-y-0 translate-y-1 translate-y-2 translate-y-4">
        
        <!-- Interactivity -->
        <div class="cursor-auto cursor-default cursor-pointer cursor-wait cursor-text cursor-move cursor-help cursor-not-allowed">
        <div class="select-none select-text select-all select-auto">
        <div class="pointer-events-none pointer-events-auto">
        
        <!-- Responsive prefixes -->
        <div class="sm:block sm:flex md:block md:flex lg:block lg:flex xl:block xl:flex 2xl:block 2xl:flex">
        <div class="sm:p-4 md:p-6 lg:p-8 xl:p-10">
        <div class="sm:text-sm md:text-base lg:text-lg xl:text-xl">
        <div class="sm:w-1/2 md:w-1/3 lg:w-1/4 xl:w-1/5">
        
        <!-- Hover states -->
        <div class="hover:bg-gray-50 hover:bg-gray-100 hover:bg-gray-200 hover:text-gray-600 hover:text-gray-700 hover:text-gray-800">
        <div class="hover:shadow hover:shadow-md hover:shadow-lg hover:opacity-75 hover:opacity-100">
        <div class="hover:scale-105 hover:scale-110 hover:rotate-1 hover:rotate-3">
        
        <!-- Focus states -->
        <div class="focus:outline-none focus:ring focus:ring-blue-500 focus:ring-opacity-50">
        <div class="focus:bg-white focus:text-black focus:border-blue-500">
        
        <!-- Active states -->
        <div class="active:bg-gray-200 active:transform active:scale-95">
        
        <!-- Space and Divide -->
        <div class="space-x-1 space-x-2 space-x-3 space-x-4 space-x-6 space-x-8">
        <div class="space-y-1 space-y-2 space-y-3 space-y-4 space-y-6 space-y-8">
        <div class="divide-x divide-y divide-gray-200 divide-gray-300">
        
        </div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></span></p></h1></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
        </body>
        </html>
        EOF
        
    - name: Build Tailwind CSS
      run: |
        echo "–°–æ–∑–¥–∞–µ–º Tailwind CSS —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –∫–ª–∞—Å—Å–æ–≤..."
        ./tailwindcss -i ./src/input.css -o ./assets/tailwind.min.css --minify
        
        if [ -f assets/tailwind.min.css ]; then
          echo "‚úÖ CSS —Å–æ–∑–¥–∞–Ω –≤ assets/tailwind.min.css"
          echo "üìä –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:"
          ls -lh assets/tailwind.min.css
          echo "üìÑ –ü–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏:"
          head -3 assets/tailwind.min.css
        else
          echo "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è CSS"
          exit 1
        fi
        
    - name: Update HTML
      run: |
        python3 << 'EOF'
        import re
        
        with open('index.html', 'r', encoding='utf-8') as f:
            content = f.read()
        
        # –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ CSS
        content = re.sub(r'<link rel="stylesheet" href="\./assets/tailwind\.min\.css">', '', content)
        content = re.sub(r'<link rel="stylesheet" href="\./css/tailwind\.min\.css">', '', content)
        
        # –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–≤—ã–π script –∏ –¥–æ–±–∞–≤–ª—è–µ–º CSS –ø–æ—Å–ª–µ –Ω–µ–≥–æ
        first_script_end = content.find('</script>')
        if first_script_end != -1:
            insert_pos = first_script_end + len('</script>')
            css_link = '\n\n<!-- –õ–æ–∫–∞–ª—å–Ω—ã–π Tailwind CSS -->\n<link rel="stylesheet" href="./assets/tailwind.min.css">\n'
            content = content[:insert_pos] + css_link + content[insert_pos:]
            print("‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π CSS")
        
        with open('index.html', 'w', encoding='utf-8') as f:
            f.write(content)
        EOF
        
    - name: Cleanup
      run: rm -f tailwindcss temp-classes.html
        
    - name: Check changes
      id: verify-changed-files
      run: |
        if [ -n "$(git status --porcelain)" ]; then
          echo "changed=true" >> $GITHUB_OUTPUT
          echo "‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è"
          git status --porcelain
        else
          echo "changed=false" >> $GITHUB_OUTPUT
          echo "‚ÑπÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç"
        fi
        
    - name: Commit and push changes
      if: steps.verify-changed-files.outputs.changed == 'true'
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: 'üé® –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω—É—é —Å–±–æ—Ä–∫—É Tailwind CSS [skip ci]'
        file_pattern: 'assets/tailwind.min.css src/input.css tailwind.config.js index.html'
        commit_user_name: 'GitHub Action'
        commit_user_email: 'action@github.com'
